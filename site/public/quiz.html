<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="quiz.css">
 <title>Quiz de Investimentos</title>
</head>
<body>
  <header class="header2">
    <div class="cabecalho cadastro-header">
      <h1 class="titulo">[S]³</h1>
      <nav class="navbar">
        <ul>
          <li><a href="simulador.html">Simulador</a></li>
          <li><a href="index.html">Sair</a></li>
          <li><a href="dashboard.html">Dados</a></li>
        </ul>
      </nav>
    </div>
    <div class="tituloheader">
      <h2>Quiz de Investimentos!</h2>
    </div>
  </header>
  
  <h2>Teste seus conhecimentos</h2>
  
  <main>
    <div class="content">
      <span class="spnQtd"></span>
      <span class="question"></span>
      <div class="answers"></div>
    </div>
    <div class="finish">
      <span></span>
      <button>Reiniciar</button>
      <link rel="stylesheet" href="dashboard.html">
    </div>
  </main>
  <footer>
    <p>&copy; 2025 [S]³ Investimentos | Todos os direitos reservados</p>
    <p><a href="mailto:samuel.asantos@sptech.school">samuel.asantos@sptech.school</a></p>
  </footer>
  <script>
  
    const questions  = [

    {
    question: "O que é investir?",
    answers: [
      { option: "Gastar dinheiro sem preocupação de retorno", correct: false },
      { option: "Aplicar dinheiro com o objetivo de obter lucro no curto, médio ou longo prazo", correct: true },
      { option: "Guardar dinheiro sem gerar retorno", correct: false },
    ],
  },
  {
    question: "O que é Tesouro Direto?",
    answers: [
      { option: "Um investimento em imóveis", correct: false },
      { option: "Um título do governo", correct: true },
      { option: "Uma ação de empresa privada", correct: false },
    ],
  },
  {
    question: "O que é CDB?",
    answers: [
      { option: "Um título do governo", correct: false },
      { option: "Um investimento em ações", correct: false },
      { option: "Um título bancário", correct: true },
    ],
  },
  {
    question: "O que significa 'rentabilidade' em investimentos??",
    answers: [
      { option: "Previsibilidade de retorno", correct: false },
      { option: "Rendimento fixo com baixo risco", correct: false },
      { option: "Ganhos ou perdas dependem do desempenho do mercado", correct: true },
    ],
  },
   {
    question: "Como o blog sugere que o investidor escolha o melhor investimento?",
    answers: [
      { option: "De acordo com suas metas e tolerância ao risco", correct: true },
      { option: "Somente considerando o retorno financeiro", correct: false },
      { option: "De acordo com o tanto de dinheiro que você tem", correct: false },
    ],
  },
    ];

    // Quiz variables
    let currentQuestion = 0;
    let correctAnswers = 0;
    let respostasDadas = [];  


    // DOM elements
    const spnQtd = document.querySelector(".spnQtd");
    const questionElement = document.querySelector(".question");
    const answersElement = document.querySelector(".answers");
    const finishElement = document.querySelector(".finish");
    const finishSpan = document.querySelector(".finish span");
    const finishButton = document.querySelector(".finish button");

    // Initialize quiz
    function init() {
      spnQtd.innerHTML = `${currentQuestion + 1}/${questions .length}`;
      loadQuestion();
    }

    // Load question
    function loadQuestion() {
      const question = questions [currentQuestion];
      questionElement.innerHTML = question.question;
      
      answersElement.innerHTML = "";
          question.answers.forEach(answer => {
        const button = document.createElement("button");
        button.innerHTML = answer.option;
         button.addEventListener("click", () => selectAnswer(answer.correct, answer.option, currentQuestion));
       answersElement.appendChild(button);
});   };
    


    function selectAnswer(correct, selectedOption, questionIndex) {
  
    respostasDadas.push({
    pergunta: questionIndex + 1,
    resposta: selectedOption
  });

  if (correct) correctAnswers++;

  currentQuestion++;
  if (currentQuestion < questions .length) {
    init();
  } else {
    finish();
  }
}

function finish() {
  const percentage = Math.round((correctAnswers / questions .length) * 100);
  let message = "";

  if (percentage >= 80) {
    message = `Parabéns! Você acertou ${correctAnswers} de ${questions .length} (${percentage}%). Excelente conhecimento sobre investimentos!`;
  } else if (percentage >= 50) {
    message = `Você acertou ${correctAnswers} de ${questions .length} (${percentage}%). Bom resultado, mas pode melhorar!`;
  } else {
    message = `Você acertou ${correctAnswers} de ${questions.length} (${percentage}%). Recomendamos estudar mais sobre investimentos.`;
  }

  finishSpan.innerHTML = message;
  document.querySelector(".content").style.display = "none";
  finishElement.style.display = "flex";


  const fkusuario_id = sessionStorage.getItem('ID_USUARIO');

  if (!fkusuario_id) {
    console.log("Usuário não identificado. Não será possível salvar o resultado.");
    return; 
  }

  fetch('/api/salvar-respostas-quiz', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
    fkusuario_id: fkusuario_id,
    acertos: correctAnswers,
    totalPerguntas: questions .length,
    percentual: percentage,
    respostas: respostasDadas
  })

})
  .then(res => {
    if (!res.ok) return res.text().then(text => { throw new Error(text) });
    return res.json();
  })
  .then(data => {
    console.log('Resultado enviado com sucesso:', data);
  })
  .catch(err => {
    console.error('Falha ao enviar resultado:', err);
  });
}

    // Restart quiz
    finishButton.addEventListener("click", () => {
      currentQuestion = 0;
      correctAnswers = 0;
      document.querySelector(".content").style.display = "flex";
      finishElement.style.display = "none";
      init();
    });

    // Start quiz
    init();
  </script>
</body>
</html>